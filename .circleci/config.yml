version: 2.1
jobs:
    build:
        docker:
            - image: circleci/node:latest
        steps:
            - checkout
            - run: npm install
            - run: npm i snyk
            - run: npm i snyk-delta

    test:
      docker:
        - image: cimg/node:16.10
      steps:
        - checkout
        - run: snyk auth $SNYK_TOKEN_2
        - run: snyk test --json --print-deps | snyk-delta

workflows:
  build_and_test:
    jobs:
      - build
      - test:
          requires:
            - build

